Instructions for raspi-sources --

# First, on build-workstation, remove any existing sources folder
cd /home/${_user}/raspi-sources
rm -r linux
# ignore (deprecated) ./update-ebuild.sh   ## created for  EGIT based ebuild, but I'm now downloading, and making tarball myself

# See https://www.raspberrypi.com/documentation/computers/linux_kernel.html#choosing_sources
# Manually clone raspberry-pi sources
# browse https://www.kernel.org/ to determine latest stable version of kernel
# browse https://github.com/raspberrypi/linux.git and note available branches and tags
_user=joe               # example
model=bcm2712-rpi-5-b   # example
branch_version=X.Z      # example 6.12
git clone --depth 1 --branch rpi-${branch_version}.y https://github.com/raspberrypi/linux.git linux-${branch_version}.y

cd linux-${branch_version}.y
kernelversion=$(make kernelversion) ; echo "kernelversion: $kernelversion"
cd ..
mv linux-${branch_version}.y linux-${kernelversion}-raspi

# then see README-tar-command
tar --exclude '.git*' -cvjpf linux-${kernelversion}-raspi.tbz2 linux-${kernelversion}-raspi

# create link for kernelupdate use
ln -snf linux-${kernelversion}-raspi linux

# create sha512sum
sha512sum linux-${kernelversion}-raspi.tbz2 > linux-${kernelversion}-raspi.tbz2.sha512sum

# scp tarball and sha512sum to raspi56406 to publish
scp linux-${kernelversion}-raspi.tbz2 raspi56406:/home/${_user}/
scp linux-${kernelversion}-raspi.tbz2.sha512sum raspi56406:/home/${_user}/

# now go to raspi56406 and verify that move_joetoo_sources_to_webserver (cron job)
# has moved tarball and sha512sum from /home/${_user}/ to /var/www/localhost/htdocs/raspi-sources/
# alternatively, use curl to look for the file remotely
url="https://raspi56406.brendler/raspi-sources/linux-${kernelversion}-raspi.tbz2"
if curl -sfI "$url" > /dev/null; then echo "File exists!"; else echo "File not found (or server error)."; fi

# (as _user) link the new sources and seed a .config file from a running system
cd ~/My_${model}_project/
ln -snf /home/${_user}/raspi-sources/linux linux
cd kernelconfigs/
scp raspi56407:/boot/config-* ./
cp kernelconfigs/<myrunningconfig> build/${model}/.config

# now (as root) run kernelupdate
eselect kernelupdate list/set
kernelupdate
