Instructions for amlogic-sources --

# First remove any existing sources folder
cd /home/${user}/amlogic-sources
rm -r linux

# (based on review of log that armbian generated during build)
# browse https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux
# click the one armbian is building (Branch: "6.12.y" which shows commit msg 6.12.42)
# then click the box with the "v6.12.42" --> commit #and signature
# then click the linux-6.12.42.tar.gz link to download  (or use this url with wget)
# (this downloads a tarball directly)

# if you download from a browser, move it to sources dir
mv /home/${user}/Downloads/linux-6.12.42.tar.gz cd /home/${user}/amlogic-sources/

# move to your sources directory
cd /home/${user}/amlogic-sources

# you can skip the first step above and browse to verify (above)
# then use wget to directly download a tarball for the version you want
wget https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6.12.42.tar.gz

# unpack the archive and link it as "linux" for reference by links in kernelupdate's <project_root> directories
tar xvpf linux-6.12.42.tar.gz
ln -snf linux-6.12.42 linux

# it is not necessary to scp the tarball to our server (raspi56406)
# because our ebuild can download it as SRC_URL, just like we did

# But we do need to make a new ebuild for this version
cd /home/${user}/joetoo/sys-kernel/amlogic-sources/
cp <recent_version>.ebuild <current_version>.ebuild

# (as user) link the new sources and seed a .config file from a running system
cd ~/My_${model}_project/
ln -snf /home/${user}/amlogic-sources/-<version> linux
cd kernelconfigs/
scp lcsp6401:/boot/config-* ./
cp kernelconfigs/<myrunningconfig> build/${model}/.config

# now run kernelupdate (as root)
eselect kernelupdate list/set
kernelupdate

#-----[ UEFI note ]--------------------------------------------------
# as of Aug 2025, all three of our amlogic boards --
# ( sweetpotato, solitude, and alta ) support UEFI
# with a u-boot bootloader installed on SPI-NOR MTD, so 
# it is not necessary to build a kernel for each --
# easy button: use the Armbian build script to build the
# arm64_uefi kernel for all arm64 boards that support uefi

#-----[ alternative ways to get same sources ]---------------------
# See https://www.raspberrypi.com/documentation/computers/linux_kernel.html#choosing_sources
# browse https://www.kernel.org/ to determine latest stable version of kernel
# browse https://github.com/libre-computer-project/libretech-linux and note available branches and tags
# maybe go with "rolling-stable" or more likely that which seems to track
# the "current" armbian kernel --> "linux-6.12.y-lc" 
#branch="linux-rolling-stable"
#branch_version=6.12
#branch="linux-${branch_version}.y-lc"

#git clone --depth 1 --branch ${branch} https://github.com/libre-computer-project/libretech-linux.git

branch_version=6.12
branch="linux-${branch_version}.y"
git clone --depth 1 --branch ${branch} https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git

cd linux
kernelversion=$(make kernelversion) ; echo "kernelversion: $kernelversion"
cd ..
mv linux linux-${kernelversion}-amlogic

tar --exclude '.git*' -cvjpf linux-${kernelversion}-amlogic.tbz2 linux-${kernelversion}-amlogic

ln -snf linux-${kernelversion}-amlogic linux

scp linux-${kernelversion}-amlogic.tbz2 raspi56406:/home/${user}/

#-----[ legacy ]----------------------------------
cd libretech-linux
kernelversion=$(make kernelversion) ; echo "kernelversion: $kernelversion"
cd ..
mv libretech-linux linux-${kernelversion}-amlogic

# then create a tarball
tar --exclude '.git*' -cvjpf linux-${kernelversion}-amlogic.tbz2 linux-${kernelversion}-amlogic

# create link for kernelupdate use
ln -snf linux-${kernelversion}-amlogic linux

# scp to raspi56406 to publish
scp linux-${kernelversion}-amlogic.tbz2 raspi56406:/home/${user}/

# now go to raspi56406 and move (as root) from /home/${user}/ to /var/www/localhost/htdocs/raspi-sources/
cp /home/${user}/linux-${kernelversion}-amlogic.tbz2 /var/www/localhost/htdocs/amlogic-sources/
rm /home/${user}/linux-${kernelversion}-amlogic.tbz2

# now go to thuvia and run (as root)
eselect kernelupdate list/set
kernelupdate
