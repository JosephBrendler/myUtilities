#!/bin/bash
# Joe Brendler - 11 November 2016
# Wrapper script to automate my initramfs build procedure
# the GLOBALS file identifies the BUILD, SOURCES_DIR (e.g. /usr/src/initramfs), and the MAKE_DIR (parent dir of this script)
# Note: you must first move to the directory containing these scripts (the ${MAKE_DIR})
source script_header_joe_brendler
source GLOBALS

[ -d ${SOURCES_DIR} ] && rm -r ${SOURCES_DIR}         # clean up the initramfs sources generated by the last run
${MAKE_DIR}/make_sources.sh                           # this (re-)creates and (re-)loads the ${SOURCES_DIR}

[ ! -e /boot/grub/grub.conf ] && mount -o rw /boot    # mount the boot device if it wasn't already      
${MAKE_DIR}/make_image.sh                             # generate and install the acutal image (cpio.gz archive of the sources)

separator "Please verify the results, below" "initramfs-${BUILD} installed"
cd /boot/
ls -al /boot/ | grep initramfs                        # show the results
