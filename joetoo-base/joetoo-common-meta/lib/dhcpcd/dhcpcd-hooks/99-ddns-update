#!/bin/sh
#
# 99-ddns-update   (c) joe brendler 2025-4799
#
# dhcpcd hook to run /etc/dhcpcd.ddns-update.sh
# (ddns update script)on IPv6 address assignment to update dns's /etc/hosts.d/30_ddns_clients file
#
debugging_log=/tmp/dhcpcd.ddns-update.debug.log

# Program Name - this should reflect "dhcpcd-run-hooks" which runs hooks by sourcing them
PN=$(basename $0)

# log debugging info
echo "${PN} ran at $(date)" >> "${debugging_log}"
echo "${PN} has enviroment variable reason.........: [$reason]" >> "${debugging_log}"
echo "${PN} has enviroment variable interface......: [$interface]" >> "${debugging_log}"
echo "${PN} has enviroment variable old_ip6_address: [$old_ip6_address]" >> "${debugging_log}"
echo "${PN} has enviroment variable new_ip6_address: [$new_ip6_address]" >> "${debugging_log}"
echo >> "${debugging_log}"

# Pass ALL necessary environment variables for smart update
# when any of these "reason" events triggers the hook
# this enables the /etc/dhcpcd.ddns-update.sh script
if [ "$reason" = "IPV6L_UP" ] || \
   [ "$reason" = "IPV6_UP" ] || \
   [ "$reason" = "IPV6L_RENEW" ] || \
   [ "$reason" = "IPV6_RENEW" ] || \
   [ "$reason" = "IPV6L_EXPIRE" ] || \
   [ "$reason" = "IPV6_EXPIRE" ] || \
   [ "$reason" = "BOUND" ] || \
   [ "$reason" = "STOPPED" ] || \
   [ "$reason" = "CARRIER" ] || \
   [ "$reason" = "ROUTERADVERT" ] || \
   [ "$reason" = "DECONFIG" ]; then
    /etc/dhcpcd.ddns-update.sh "$reason" "$interface" "$old_ip6_address" "$new_ip6_address"
fi
