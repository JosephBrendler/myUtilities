#!/bin/bash
# these functions are used by several scripts (make_sources.sh, ckinitramfs, and the init script)
# they are consolidated here as of release 9.0.1
#

#----[ These bash shell functions are used in make_sources.sh, ckinitramfs, and scratch_test ]---------------
#                        **** they will not work in ash shell ****
load_executables()
{
  # read the list of executables; and load into a bash array the full pathname on the host system
  # 20260126 - converted init_executables to bash array
  local _le_target="" _le_name="" i=0
  executables=()
  # loop through all executables listed in init_structure's array
  for _le_name in "${init_executables[@]}"; do
    # skip empty or commented elements
    [[ -z "$_le_name" || "$_le_name" == "#"* ]] && continue
    # find the actual executable referred to by the name in init_executables[]
    _le_target=$(which "$_le_name" 2>/dev/null)
    if [[ -z "$_le_target" ]]; then
        E_message "Warning: executable [$_le_name] not found on host"
    else
      executables+=("$_le_target")
      d_message "$i: $_le_name -> $_le_target | executables[$i] ${executables[$i]}" 3
      let i++
    fi
  done
}


list_executables()
{ # @usage list_executables
  # @note outputs resolved paths, one per line
  # maintainer note: printf s designed to loop the format string until
  #   all provided arguments are consumed (i.e. outputs one array element per line here)
  printf '%s\n' "${executables[@]}"
}

dump_executables()
{ # @usage dump_executables
  local i=0 _de_val
  for _de_val in "${executables[@]}"; do
    message_n ""
    printf '%02d: %s\n' "$((i++))" "$_de_val"
  done
  message "dumped ${#executables[@]} executables"
}
