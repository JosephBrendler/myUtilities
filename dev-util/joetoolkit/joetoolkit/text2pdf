#!/bin/bash
# text2pdf - (c) joe brendler 2025-2055
#
source /usr/sbin/script_header_joetoo
source /usr/sbin/script_header_joetoo_unicode

VERBOSE=$TRUE
[ -z $verbosity ] && verbosity=3  # assign default if null; allow calling program to dictate

PN=$(basename $0)

separator ${PN} $(hostname)

user="joe"

# temporary, until I add this to script_header
VS16="\UFE0F"

#-----[ variables ]--------------------------------------------------

old_dir=$(pwd)

#-----[ functions ]--------------------------------------------------
usage() {
    E_message "${BRon}usage: ${BGon}${PN} <INPUT_TEXT_FILE>${Boff}"
    exit 1
}

debug_marker() {
    bremoji "${heart_red}${VS16}" ; echo -n " "
    echo -e -n "${Ron}D${BRon}e${Yon}b${BYon}u${Gon}g${BGon}_${LBon}M${Bon}a${BBon}r${Mon}k${BMon}e${Won}r${BWon}!${Boff}"
    echo -n " " ; bremoji $explosion; echo
    exit 1
}

convert_text_to_pdf() {
    cat "${input_file}" | enscript -o - | ps2pdf - "${output_file}"
    return $?
}

#-----[ main script ]------------------------------------------------

[ $# -eq 0 ] && E_message "input file not specified" && usage
[ $# -gt 2 ] && E_message "invalid arguments" && usage
input_file="$1"
if [ ! -z "$2" ] ; then
    output_file="$2"
else
    output_file="${input_file}.pdf"
fi

separator $(hostname) ${PN}

convert_text_to_pdf || die "failed to convert_text_to_pdf"
bremoji "$face_beam"
echo -e -n " (${BGon}success!${Boff})"

message_n "moving back to old_dir [$old_dir]"
cd "$old_dir" || die "failed to cd to old_dir"
right_status $TRUE

message "${BGon}Done${Boff}"

#debug_marker
