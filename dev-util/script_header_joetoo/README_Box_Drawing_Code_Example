#!/bin/bash

# === VT CHARACTER SET DEFINITIONS ===

# 1. ESC(C Sequences (Explicit G0 Selection)
ESCon='\033(0'     # Maps G0 to DEC Special Graphics (Enable Graphics)
ESCoff='\033(B'    # Maps G0 to Standard ASCII (Disable Graphics)
ESG1='\033)0'      # Maps G1 to DEC Special Graphics (Setup for SI/SO)

# 2. Shift In/Out Control Characters (Fast G0/G1 Toggling)
SO='\016'          # Shift Out (Activate G1, Graphics ON - ASCII 14)
SI='\017'          # Shift In (Activate G0, Standard ASCII ON - ASCII 15)

# 3. Graphics Character Codes (Using portable octal escapes)
H_wall='\161'      # Horizontal line (0x71)
V_wall='\170'      # Vertical line (0x78)
UL_wall='\154'     # Upper-Left corner (0x6C)
UR_wall='\153'     # Upper-Right corner (0x6B)
LL_wall='\155'     # Lower-Left corner (0x6D)
LR_wall='\152'     # Lower-Right corner (0x6A)

# ------------------------------------------------------------------

## Function to perform the required G0/G1 mapping once for the SI/SO method
init_vt_graphics() {
    # 1. Ensure Standard ASCII ('B') is mapped to G0 (primary display set)
    # 2. Map DEC Special Graphics ('0') to G1 (secondary set)
    # This prepares the terminal for the fast SI/SO switching.
    printf "%b%b" "$ESCoff" "$ESG1"
}

# ------------------------------------------------------------------

## 1. Box Drawing using the ESCon/ESCoff (Explicit G0 mapping) method
draw_box_esca() {
    local text="$1"
    local TEXT_LEN=${#text}
    local H_LINE_WIDTH=$((TEXT_LEN + 2)) 
    
    H_LINE=$(printf "%*s" "$H_LINE_WIDTH" | tr ' ' "$H_wall")

    printf "\n# --- ESCon/ESCoff Method ---\n"
    
    # Top Line: ESCon, UL_wall, H_LINE, UR_wall, ESCoff
    printf "%b%b%s%b%b\n" "$ESCon" "$UL_wall" "$H_LINE" "$UR_wall" "$ESCoff"
    
    # Content Line: ESCon, V_wall, ESCoff, text, ESCon, V_wall, ESCoff
    printf "%b%b %b%s%b %b%b\n" \
        "$ESCon" \
        "$V_wall" \
        "$ESCoff" \
        "$text" \
        "$ESCon" \
        "$V_wall" \
        "$ESCoff"

    # Bottom Line: ESCon, LL_wall, H_LINE, LR_wall, ESCoff
    printf "%b%b%s%b%b\n" "$ESCon" "$LL_wall" "$H_LINE" "$LR_wall" "$ESCoff"
}

# ------------------------------------------------------------------

## 2. Box Drawing using the SO/SI (Fast G0/G1 switching) method
draw_box_shift() {
    local text="$1"
    local TEXT_LEN=${#text}
    local H_LINE_WIDTH=$((TEXT_LEN + 2)) 
    
    H_LINE=$(printf "%*s" "$H_LINE_WIDTH" | tr ' ' "$H_wall")

    printf "\n# --- SO/SI Method ---\n"
    
    # Top Line: SO, UL_wall, H_LINE, UR_wall, SI
    printf "%b%b%s%b%b\n" "$SO" "$UL_wall" "$H_LINE" "$UR_wall" "$SI"
    
    # Content Line: SO, V_wall, SI, text, SO, V_wall, SI
    printf "%b%b %b%s%b %b%b\n" \
        "$SO" \
        "$V_wall" \
        "$SI" \
        "$text" \
        "$SO" \
        "$V_wall" \
        "$SI"

    # Bottom Line: SO, LL_wall, H_LINE, LR_wall, SI
    printf "%b%b%s%b%b\n" "$SO" "$LL_wall" "$H_LINE" "$LR_wall" "$SI"
}

# ------------------------------------------------------------------
# --- SCRIPT EXECUTION ---
# 1. Perform the one-time G0/G1 mapping required for the SO/SI method
init_vt_graphics

# 2. Draw Box 1 (ESCon/ESCoff Method)
draw_box_esca "Box Drawn via ESC(0 and ESC(B"

# 3. Draw Box 2 (SO/SI Method)
draw_box_shift "Box Drawn via SO and SI"
