#!/bin/bash
# source cb-layout-device - specific usage-module which should be built in the same format
# this file must contain legitimate bash assignments and commands
# it will be sourced by the using script via the sourcing of script_header_joetoo_extended usage() function
# Note: options i, n, s, r, v, q are already used by the default cmdline processor
#
user=joe
stockpile="/home/${user}/sbc-stockpile"
echo
E_message "${BRon}minimal usage: ${BGon}${PN} ${BMon}-u${LBon} <UPDATEIMAGE>${Boff}"
echo
message "  -u | --updateimage <UPDATEIMAGE>.....: specify UPDATEIMAGE (selects crossbuild BOARD & TARGET)"
E_message "  -u <UPDATEIMAGE> must be used separately and cannot be combined w/ other option letters"
E_message "  (for example: ${BGon}${PN} ${BMon}-ivu${Boff} <bd_hn.img> ${BMon}will fail b/c of ${BRon}-ivu${Boff})"
echo
message "${BMon}notes:${Boff}"
message "  ${BYon}(1) exactly one <UPDATEIMAGE> must be specified.  ${LBon}Examples:${Boff}"
message "  ${LBon}These are currently available --${Boff}"
# set shell globbing options to count files in the mountpoint directory
# nullglob ensures that a pattern matching no files expands to nothing
# (rather than the pattern itself), and dotglob includes dotfiles (hidden files)
# The files array will be empty if the directory is empty
shopt -s nullglob dotglob
images=("${stockpile%/}"/*.img)
[ ${#images[@]} -eq 0 ] && die "There are no stockpiled crossbuild .env or .img files available"
for image in ${images[@]}; do echo "         $(basename ${image})" ; done
shopt -u nullglob dotglob # Unset the options after use
echo -e "      (${BMon}specify basename of <UPDATEIMAGE> only, do not include path${Boff})"
echo
message "  ${BYon}(2) exactly one <BOARD> will be derived from the stockpiled <UPDATEIMAGE> filename${Boff}"
message "      e.g. the UPDATEIMAGE: ${LBon}bcm2708-rpi-b_raspi13201.img${Boff} uses BOARD: ${Mon}bcm2708-rpi-b${Boff}"
message "      <UPDATEIMAGE> will be copied to /usr/<BOARD>.img and mounted at /usr/<TARGET>"
echo
message "  ${BYon}(3) exactly one <TARGET> will be selected automatically. Examples:${Boff}"
message "      aarch64-unknown-linux-gnu"
message "      armv6j-unknown-linux-gnueabihf"
message "      armv7a-unknown-linux-gnueabihf"
echo
message "${BMon}find additionl information at /etc/crossbuild-tools/README${Boff}"
