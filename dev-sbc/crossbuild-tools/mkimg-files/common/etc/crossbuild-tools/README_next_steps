echo 
echo "NEXT STEPS"
echo "Note: this file is designed to be sourced in a joetoo environment"
echo "Re-read at any time with e.g. source /etc/crossbuild-tools/README_next_steps"
echo
    message "${BYon}Image construction is complete, but there is more to do...${Boff}"
    message "Your wifi may not work if you don't have the right drivers"
    message "  for various raspberry pi boards, see this reference -"
    message "  https://wiki.gentoo.org/wiki/Raspberry_Pi_Install_Guide"
    message ""
    message "${LBon}These are steps you should take now, while in the chroot --${Boff}"
    message "  + edit /root/.bashrc and /home/<user>/.bashrc"
    message "  + remove from make.conf chroot variables like ROOT=/usr/<TARGET>/"
    message "  + edit make.conf assignments for PORTDIR, DISTDIR, PKGDIR, etc"
    message "  + reset ownership of user files, e.g. chown -R joe:joe /home/joe "
    message ""
    message "${LBon}These are steps in subsequent deployment of the image --${Boff}"
    message "  + exit the qemu-chroot"
    message "  + format/layout an SD card or other external device"
    message "    HINT: on a working system, run e.g. fdisk -l /dev/mmcblk0"
    message "        and match that layout on a new empty device"
    message "    NOTE: for rockchip boards, u-boot must also be installed"
    message "    (it should have been made available in the image by"
    message "     installation of sys-boot/rockchip-boot-fw::joetoo ->"
    message "     /boot/u-boot_reflash_resources/u-boot_reflash_instructions"
    message "  + mount the external device to /mnt/to and /mnt/to/boot"
    message "  + copy from image w e.g. cp -av /usr/${TARGET}/* to /mnt/to/ "
    message ""
    message "${LBon}These things have to be done after the image is deployed to new media--${Boff}"
    message "  + use blkid to fix /etc/fstab (change partuuid for / and /boot)"
    message "    HINT: use e.g. blkid | grep /sdb >> /mnt/to/etc/fstab; nano /mnt/to/etc/fstab"
    message "  + use the same info to update boot config .txt file(s) --"
    message "    rapsi: cmdline.txt, config.txt | rockchip: joetooEnv.txt"
    message "  + confirm/create appropriate links/paths in boot config, e.g. Image -> vmlinuz..."
    message "  + create swapfile ; turn it on ; add swap to /etc/fstab"
    message "    (use host system swap until new image media is deployed)"
    message "    (for RAM < 2G, swap = 2 * RAM; for RAM > 2G, swap = RAM + 2G for example --"
    message "        cd /mnt/to/var/cache/swap"
    message "        dd if=/dev/zero of=swap1  bs=1M count=4096 status=progress"
    message "        chmod 600 swap1 ; mkswap swap1"
    message ""
    message "${LBon}When finished deploying the image, un-mount as follows --${Boff}"
    message "  + cd; umount -R /mnt/to ; cb-umount \${BOARD}"
    message "    NOTE: to umount ${BOARD}.img manually, --"
    message "        umount -R /usr/${TARGET}"
    message '        loop_dev=$(echo $root_dev | sed "s|p2||")'
    message '        losetup -D ${loop_dev}'
    message ""
    message "${LBon}These things have to be done after the deployed image boots --${Boff}"
    message "  on a real system for the first time --"
    message "  + verify current date/time"
    message "  + examine output of dmesg and logs, fix issues"
    message "  + run emerge --sync or eix-sync/update"
    echo
    message "${BWon}To do: some of the above may be automated by additional tools...${Boff}"
echo 
echo "NEXT STEPS"
echo "Note: this file is designed to be sourced in a joetoo environment"
echo "Re-read at any time with e.g. source /etc/crossbuild-tools/README_next_steps"
echo
